<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Calculadora de Precisão: Dose Real</title>
    <style>
        :root { 
            --cor-caneta: #2c3e50; 
            --cor-primaria: #00cec9;
            --bg-gradiente: linear-gradient(135deg, #a8e6cf 0%, #dcedc1 50%, #81ecec 100%);
        }

        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: var(--bg-gradiente);
            background-attachment: fixed;
            display: flex; 
            justify-content: center; 
            min-height: 100vh;
            margin: 0;
            padding: 15px; 
            box-sizing: border-box;
        }

        .container { 
            background: rgba(255, 255, 255, 0.98); 
            padding: 20px; 
            border-radius: 20px; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.1); 
            max-width: 800px; 
            width: 100%; 
            height: fit-content;
        }

        h1 { color: var(--cor-caneta); text-align: center; font-size: 1.5rem; margin-bottom: 20px; }
        
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        
        .card { 
            border: 1px solid #f1f1f1; 
            padding: 15px; 
            border-radius: 15px; 
            background: #fff; 
        }

        /* Desenho da Caneta */
        .pen-container { height: 60px; display: flex; align-items: center; justify-content: center; margin-bottom: 10px; }
        .pen-body { width: 140px; height: 25px; background: var(--cor-caneta); border-radius: 5px 15px 15px 5px; position: relative; }
        .pen-window { width: 30px; height: 10px; background: #e0f7fa; position: absolute; right: 30px; top: 7px; border: 1px solid #fff; }

        label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 13px; color: #555; }
        input, select { 
            width: 100%; padding: 10px; margin-bottom: 12px; 
            border: 2px solid #eee; border-radius: 8px; 
            font-size: 16px; /* Tamanho 16px evita zoom no iOS */
            box-sizing: border-box;
        }

        canvas { background: #fff; display: block; margin: 0 auto; max-width: 100%; }

        .result-box { 
            margin-top: 20px; padding: 15px; 
            background: linear-gradient(135deg, #2ecc71, #27ae60); 
            color: white; border-radius: 12px; text-align: center; 
            font-weight: 500; font-size: 1rem;
        }

        .btn-limpar {
            width: 100%; padding: 12px; margin-top: 15px;
            background: #e74c3c; color: white; border: none;
            border-radius: 8px; font-weight: bold; cursor: pointer;
            transition: background 0.3s;
        }
        .btn-limpar:hover { background: #c0392b; }

        @media (max-width: 650px) {
            .grid { grid-template-columns: 1fr; }
            h1 { font-size: 1.2rem; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Calculadora de Equivalência</h1>
    
    <div class="grid">
        <div class="card">
            <div class="pen-container">
                <div class="pen-body"><div class="pen-window"></div></div>
            </div>
            <label>Volume da Caneta (ml):</label>
            <input type="number" id="pen_ml" placeholder="Ex: 3" step="any" oninput="calculate('ui')">
            
            <label>Concentração total (mg):</label>
            <input type="number" id="pen_mg" placeholder="Ex: 18" step="any" oninput="calculate('ui')">
            
            <hr>
            <label style="color: #2980b9;">Para ter X mg (Dose Alvo):</label>
            <input type="number" id="target_mg" placeholder="Digite quantos mg deseja" step="any" oninput="calculate('mg')">
        </div>

        <div class="card" style="text-align:center;">
            <label>Seringa:</label>
            <select id="syringe_type" onchange="calculate('ui')">
                <option value="100">100 UI (1.0 ml)</option>
                <option value="50">50 UI (0.5 ml)</option>
            </select>

            <label>Marcação na Seringa (UI):</label>
            <input type="number" id="dosage_ui" placeholder="Ex: 10" step="any" oninput="calculate('ui')">
            
            <canvas id="syringeCanvas" width="140" height="250"></canvas>
        </div>
    </div>

    <div class="result-box" id="result">Preencha os dados da caneta.</div>
    
    <button class="btn-limpar" onclick="limpar()">Limpar Dados</button>
</div>

<script>
    function calculate(mode) {
        const mlTotal = parseFloat(document.getElementById('pen_ml').value) || 0;
        const mgTotal = parseFloat(document.getElementById('pen_mg').value) || 0;
        let uiInput = document.getElementById('dosage_ui');
        let mgInput = document.getElementById('target_mg');
        const syringeType = parseFloat(document.getElementById('syringe_type').value);

        if (mlTotal <= 0 || mgTotal <= 0) {
            document.getElementById('result').innerText = "Informe Volume e Concentração da caneta.";
            return;
        }

        const mgPerMl = mgTotal / mlTotal;

        if (mode === 'ui') {
            // Calcula MG a partir da UI digitada
            let uiValue = parseFloat(uiInput.value) || 0;
            let mgCalculado = (uiValue / 100) * mgPerMl;
            mgInput.value = uiValue > 0 ? mgCalculado.toFixed(2) : "";
            updateUI(uiValue, mgCalculado, mgTotal, mlTotal, syringeType);
        } else {
            // Calcula UI a partir do MG digitado (Lógica Inversa)
            let mgValue = parseFloat(mgInput.value) || 0;
            let uiCalculado = (mgValue / mgPerMl) * 100;
            uiInput.value = mgValue > 0 ? uiCalculado.toFixed(1) : "";
            updateUI(uiCalculado, mgValue, mgTotal, mlTotal, syringeType);
        }
    }

    function updateUI(ui, mg, mgTotal, mlTotal, maxUI) {
        const resultDiv = document.getElementById('result');
        if (ui > 0) {
            resultDiv.innerHTML = `Na marcação de <strong>${ui.toFixed(1)} UI</strong>, você tem <strong>${mg.toFixed(2)} mg</strong>.<br><small>(Concentração: ${mgTotal}mg/${mlTotal}ml)</small>`;
        }
        drawSyringe(ui, maxUI);
    }

    function drawSyringe(ui, maxUI) {
        const canvas = document.getElementById('syringeCanvas');
        const ctx = canvas.getContext('2d');
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        const startY = 10, height = 200, width = 35, centerX = canvas.width / 2 - width / 2;

        // Corpo
        ctx.strokeStyle = "#ccc";
        ctx.strokeRect(centerX, startY, width, height);

        // Líquido
        let fillLevel = (ui / maxUI) * height;
        if (fillLevel > height) fillLevel = height;
        ctx.fillStyle = "#00cec9";
        ctx.fillRect(centerX + 2, (startY + height) - fillLevel, width - 4, fillLevel);

        // Escala
        ctx.fillStyle = "#000";
        ctx.font = "10px Arial";
        for (let i = 0; i <= maxUI; i += (maxUI/10)) {
            let yPos = (startY + height) - (i / maxUI) * height;
            ctx.beginPath(); ctx.moveTo(centerX, yPos); ctx.lineTo(centerX + 8, yPos); ctx.stroke();
            ctx.fillText(i, centerX - 18, yPos + 4);
        }

        // Pistão
        ctx.fillStyle = "#2d3436";
        ctx.fillRect(centerX + 2, (startY + height) - fillLevel - 5, width - 4, 8);
    }

    function limpar() {
        document.querySelectorAll('input').forEach(i => i.value = "");
        document.getElementById('result').innerText = "Preencha os dados da caneta.";
        drawSyringe(0, 100);
    }

    window.onload = () => drawSyringe(0, 100);
</script>

</body>
</html>