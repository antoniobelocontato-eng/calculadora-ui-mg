<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Calculadora de Precis√£o: Dose Real</title>
    <style>
        :root { 
            --cor-caneta: #2c3e50; 
            --cor-primaria: #00cec9;
            --cor-alerta: #e74c3c;
            --cor-sucesso: #27ae60;
            --bg-gradiente: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }

        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: var(--bg-gradiente);
            display: flex; justify-content: center; min-height: 100vh; margin: 0; padding: 15px; box-sizing: border-box;
        }

        .container { 
            background: white; padding: 25px; border-radius: 20px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.15); max-width: 700px; width: 100%; 
        }

        h1 { color: var(--cor-caneta); text-align: center; font-size: 1.4rem; margin-bottom: 20px; border-bottom: 2px solid var(--cor-primaria); padding-bottom: 10px; }
        
        .grid { display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 20px; }
        
        .card { border: 1px solid #edf2f7; padding: 15px; border-radius: 12px; background: #f8fafc; }

        label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 12px; color: #4a5568; }
        
        .volume-selector { display: flex; gap: 10px; margin-bottom: 15px; }
        .vol-btn { 
            flex: 1; padding: 10px; border: 2px solid #cbd5e0; border-radius: 8px; 
            background: white; cursor: pointer; font-weight: bold; transition: all 0.2s;
        }
        .vol-btn.active { background: var(--cor-primaria); border-color: #00b5b1; color: white; }

        input, select { 
            width: 100%; padding: 12px; margin-bottom: 15px; 
            border: 2px solid #cbd5e0; border-radius: 8px; font-size: 16px; box-sizing: border-box;
        }

        #custom_ml_container { display: none; }

        .result-box { 
            margin-top: 20px; padding: 15px; background: #1a202c; 
            color: white; border-radius: 12px; font-size: 0.9rem; line-height: 1.6;
        }

        .info-mg-ui {
            background: #e0f7fa; color: #006064; padding: 10px; border-radius: 8px;
            font-size: 13px; margin-bottom: 15px; border-left: 5px solid #00cec9;
            font-weight: 500;
        }

        .aviso-seguranca {
            background: #fff5f5; color: #c53030; padding: 10px; border-radius: 8px;
            font-size: 11px; margin-top: 10px; border: 1px solid #feb2b2;
        }

        .dose-perfeita { color: #4fd1c5; font-weight: bold; }
        .dose-perigo { color: #fc8181; font-weight: bold; }

        @media (max-width: 600px) { .grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container">
    <h1>Verificador de Dosagem (UI)</h1>
    
    <div id="mg_per_ui_info" class="info-mg-ui" style="display:none;"></div>

    <div class="grid">
        <div class="card">
            <label>1. Volume da Caneta (ml):</label>
            <div class="volume-selector">
                <button class="vol-btn" onclick="setVolume(0.5, this)">0.5 ml</button>
                <button class="vol-btn" onclick="setVolume(0.6, this)">0.6 ml</button>
                <button class="vol-btn" onclick="setVolume('outro', this)">Outro</button>
            </div>
            
            <div id="custom_ml_container">
                <input type="number" id="pen_ml" step="0.1" placeholder="Digite o volume em ml" oninput="calculate()">
            </div>
            
            <label>2. MG total escrito na Caneta:</label>
            <input type="number" id="pen_mg" step="0.1" placeholder="Ex: 12.5" oninput="calculate()">
            
            <hr style="opacity: 0.2;">
            
            <label style="color: #2b6cb0;">3. Dose Alvo (mg):</label>
            <input type="number" id="target_mg" step="0.1" placeholder="Ex: 5" oninput="calculate()">
            
            <label style="color: #c53030;">4. UI que voc√™ pretende aspirar:</label>
            <input type="number" id="received_ui" placeholder="Quantas UI na seringa?" oninput="calculate()">
        </div>

        <div class="card" style="text-align:center;">
            <label>Tipo de Seringa:</label>
            <select id="syringe_type" onchange="calculate()">
                <option value="30">30 UI (0.3 ml)</option>
                <option value="50">50 UI (0.5 ml)</option>
                <option value="100" selected>100 UI (1.0 ml)</option>
            </select>

            <label>Marca√ß√£o Ideal (UI):</label>
            <div id="ideal_ui_display" style="font-size: 24px; font-weight: bold; color: #2b6cb0; margin: 10px 0;">--</div>
            
            <canvas id="syringeCanvas" width="120" height="220"></canvas>
        </div>
    </div>

    <div class="result-box" id="result">Preencha os dados para come√ßar.</div>

    <div class="aviso-seguranca">
        <strong>‚ö†Ô∏è ATEN√á√ÉO:</strong> Esta ferramenta √© apenas um aux√≠lio matem√°tico para confer√™ncia de fracionamento. Arredondamentos foram aplicados para marca√ß√£o em seringas f√≠sicas.
    </div>
</div>

<script>
    let selectedVolume = 0;

    function setVolume(val, btn) {
        document.querySelectorAll('.vol-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const customContainer = document.getElementById('custom_ml_container');
        const customInput = document.getElementById('pen_ml');

        if (val === 'outro') {
            customContainer.style.display = 'block';
            selectedVolume = 0; 
        } else {
            customContainer.style.display = 'none';
            selectedVolume = val;
            customInput.value = val;
        }
        calculate();
    }

    function calculate() {
        const mlInput = parseFloat(document.getElementById('pen_ml').value);
        const mlTotal = selectedVolume || mlInput || 0;
        const mgTotal = parseFloat(document.getElementById('pen_mg').value) || 0;
        const targetMg = parseFloat(document.getElementById('target_mg').value) || 0;
        const receivedUi = parseFloat(document.getElementById('received_ui').value) || 0;
        const syringeType = parseFloat(document.getElementById('syringe_type').value);
        
        const resultDiv = document.getElementById('result');
        const displayIdeal = document.getElementById('ideal_ui_display');
        const mgUiInfo = document.getElementById('mg_per_ui_info');

        if (mlTotal <= 0 || mgTotal <= 0) {
            mgUiInfo.style.display = 'none';
            resultDiv.innerHTML = "Aguardando dados da caneta...";
            drawSyringe(0, 0, syringeType);
            return;
        }

        // C√°lculo do valor por cada 1 UI
        // Como 100 UI = 1ml, ent√£o cada UI √© 0.01ml.
        const concentrationMgMl = mgTotal / mlTotal;
        const mgPerUi = concentrationMgMl / 100;

        mgUiInfo.style.display = 'block';
        mgUiInfo.innerHTML = `üí° Cada <strong>1 UI</strong> na sua seringa cont√©m <strong>${mgPerUi.toFixed(3)} mg</strong> de medicamento.`;

        if (targetMg <= 0) {
            displayIdeal.innerText = "--";
            drawSyringe(0, 0, syringeType);
            return;
        }

        const uiIdealPrecisa = targetMg / mgPerUi;
        const uiIdealArredondada = Math.round(uiIdealPrecisa);

        displayIdeal.innerText = uiIdealArredondada + " UI";

        const mgReal = receivedUi * mgPerUi;

        let html = `Para a dose de <strong>${targetMg}mg</strong>: aspire at√© a marca <strong>${uiIdealArredondada}</strong>.<br>`;
        
        if (receivedUi > 0) {
            const diff = Math.abs(mgReal - targetMg);
            const statusClass = diff < 0.1 ? 'dose-perfeita' : 'dose-perigo';
            html += `<hr style="opacity:0.2">`;
            html += `Com <strong>${receivedUi} UI</strong>, voc√™ recebe <span class="${statusClass}">${mgReal.toFixed(2)} mg</span>.`;
            html += diff < 0.1 ? `<br>‚úÖ Dose correta.` : `<br>‚ùå Diverg√™ncia detectada!`;
        }

        resultDiv.innerHTML = html;
        drawSyringe(uiIdealArredondada, receivedUi, syringeType);
    }

    function drawSyringe(uiIdeal, uiReal, maxUI) {
        const canvas = document.getElementById('syringeCanvas');
        const ctx = canvas.getContext('2d');
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        const startY = 15, height = 180, width = 30, centerX = canvas.width/2 - width/2;
        ctx.strokeStyle = "#4a5568"; ctx.lineWidth = 2; ctx.strokeRect(centerX, startY, width, height);
        if (uiReal > 0) {
            let hReal = (uiReal / maxUI) * height;
            ctx.fillStyle = "rgba(231, 76, 60, 0.4)";
            ctx.fillRect(centerX, (startY + height) - Math.min(hReal, height), width, Math.min(hReal, height));
        }
        if (uiIdeal > 0) {
            let hIdeal = (uiIdeal / maxUI) * height;
            let yPos = (startY + height) - (hIdeal);
            ctx.strokeStyle = "#2b6cb0"; ctx.lineWidth = 4;
            ctx.beginPath(); ctx.moveTo(centerX - 10, yPos); ctx.lineTo(centerX + width + 10, yPos); ctx.stroke();
        }
        ctx.fillStyle = "#2d3748"; ctx.font = "bold 10px Arial";
        for (let i = 0; i <= maxUI; i += (maxUI / 5)) {
            let y = (startY + height) - (i / maxUI) * height;
            ctx.beginPath(); ctx.moveTo(centerX, y); ctx.lineTo(centerX + 6, y); ctx.stroke();
            ctx.fillText(i, centerX - 22, y + 4);
        }
    }

    window.onload = () => drawSyringe(0, 0, 100);
</script>

</body>
</html>