<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Calculadora de Precisão: Dose Real</title>
    <style>
        :root { 
            --cor-caneta: #2c3e50; 
            --cor-primaria: #00cec9;
            --cor-alerta: #e74c3c;
            --bg-gradiente: linear-gradient(135deg, #a8e6cf 0%, #dcedc1 50%, #81ecec 100%);
        }

        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: var(--bg-gradiente);
            background-attachment: fixed;
            display: flex; 
            justify-content: center; 
            min-height: 100vh;
            margin: 0;
            padding: 15px; 
            box-sizing: border-box;
        }

        .container { 
            background: rgba(255, 255, 255, 0.98); 
            padding: 20px; 
            border-radius: 20px; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.1); 
            max-width: 800px; 
            width: 100%; 
        }

        h1 { color: var(--cor-caneta); text-align: center; font-size: 1.5rem; margin-bottom: 20px; }
        
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        
        .card { 
            border: 1px solid #f1f1f1; 
            padding: 15px; 
            border-radius: 15px; 
            background: #fff; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.02);
        }

        .pen-container { height: 50px; display: flex; align-items: center; justify-content: center; margin-bottom: 10px; }
        .pen-body { width: 140px; height: 25px; background: var(--cor-caneta); border-radius: 5px 15px 15px 5px; position: relative; }
        .pen-window { width: 30px; height: 10px; background: #e0f7fa; position: absolute; right: 30px; top: 7px; border: 1px solid #fff; }

        label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 13px; color: #555; }
        .label-azul { color: #2980b9; }
        .label-alerta { color: var(--cor-alerta); }

        input, select { 
            width: 100%; padding: 10px; margin-bottom: 12px; 
            border: 2px solid #eee; border-radius: 8px; 
            font-size: 16px; 
            box-sizing: border-box;
            transition: border-color 0.3s;
        }
        input:focus { border-color: var(--cor-primaria); outline: none; }

        canvas { background: #fff; display: block; margin: 10px auto; max-width: 100%; border: 1px solid #f9f9f9; }

        .result-box { 
            margin-top: 20px; padding: 15px; 
            background: #2d3436; 
            color: white; border-radius: 12px; text-align: center; 
            font-size: 0.95rem; line-height: 1.5;
        }

        .comparativo { font-weight: bold; color: #55efc4; margin-top: 5px; display: block; }

        .btn-limpar {
            width: 100%; padding: 12px; margin-top: 15px;
            background: var(--cor-alerta); color: white; border: none;
            border-radius: 8px; font-weight: bold; cursor: pointer;
        }

        hr { border: 0; border-top: 1px solid #eee; margin: 15px 0; }

        @media (max-width: 650px) {
            .grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Calculadora de Verificação</h1>
    
    <div class="grid">
        <div class="card">
            <div class="pen-container">
                <div class="pen-body"><div class="pen-window"></div></div>
            </div>
            
            <label>Volume da Caneta (ml):</label>
            <input type="number" id="pen_ml" placeholder="Ex: 3" oninput="calculate()">
            
            <label>Concentração total (mg):</label>
            <input type="number" id="pen_mg" placeholder="Ex: 18" oninput="calculate()">
            
            <hr>
            
            <label class="label-azul">Para ter X mg (Dose Alvo):</label>
            <input type="number" id="target_mg" placeholder="Quantos mg você deseja?" oninput="syncFromMg()">
            
            <label class="label-alerta">Qual a marcação (UI) que você recebeu?</label>
            <input type="number" id="received_ui" placeholder="UI que te venderam/entregaram" oninput="calculate()">
        </div>

        <div class="card" style="text-align:center;">
            <label>Tipo de Seringa:</label>
            <select id="syringe_type" onchange="calculate()">
                <option value="100">100 UI (1.0 ml)</option>
                <option value="50">50 UI (0.5 ml)</option>
            </select>

            <label>Marcação Ideal Calculada (UI):</label>
            <input type="number" id="dosage_ui" readonly style="background: #f9f9f9; color: #2980b9; font-weight: bold;">
            
            <canvas id="syringeCanvas" width="140" height="250"></canvas>
            <p style="font-size: 11px; color: #888;">*A marcação azul mostra onde os MG desejados deveriam estar.</p>
        </div>
    </div>

    <div class="result-box" id="result">
        Insira os dados da caneta para começar.
    </div>
    
    <button class="btn-limpar" onclick="limpar()">Limpar Tudo</button>
</div>

<script>
    function syncFromMg() {
        const mlTotal = parseFloat(document.getElementById('pen_ml').value) || 0;
        const mgTotal = parseFloat(document.getElementById('pen_mg').value) || 0;
        const targetMg = parseFloat(document.getElementById('target_mg').value) || 0;
        
        if (mlTotal > 0 && mgTotal > 0) {
            const mgPerMl = mgTotal / mlTotal;
            const uiCalculada = (targetMg / mgPerMl) * 100;
            document.getElementById('dosage_ui').value = uiCalculada.toFixed(1);
        }
        calculate();
    }

    function calculate() {
        const mlTotal = parseFloat(document.getElementById('pen_ml').value) || 0;
        const mgTotal = parseFloat(document.getElementById('pen_mg').value) || 0;
        const targetMg = parseFloat(document.getElementById('target_mg').value) || 0;
        const receivedUi = parseFloat(document.getElementById('received_ui').value) || 0;
        const syringeType = parseFloat(document.getElementById('syringe_type').value);
        const uiIdeal = parseFloat(document.getElementById('dosage_ui').value) || 0;

        const resultDiv = document.getElementById('result');

        if (mlTotal <= 0 || mgTotal <= 0) {
            resultDiv.innerText = "Aguardando dados da caneta (Volume e MG)...";
            drawSyringe(0, 0, syringeType);
            return;
        }

        const mgPerMl = mgTotal / mlTotal;
        const mgRealRecebido = (receivedUi / 100) * mgPerMl;

        let textoResultado = "";

        if (targetMg > 0) {
            textoResultado += `Para receber <strong>${targetMg}mg</strong>, a marcação correta deve ser <strong>${uiIdeal} UI</strong>.<br>`;
        }

        if (receivedUi > 0) {
            textoResultado += `<hr>Nesta marcação de <strong>${receivedUi} UI</strong> que você informou, você tem <strong>${mgRealRecebido.toFixed(2)} mg</strong> da substância.`;
            
            if (targetMg > 0 && mgRealRecebido < (targetMg * 0.95)) {
                textoResultado += `<br><span style="color:#ff7675;">⚠️ ALERTA: Você está recebendo MENOS do que o alvo desejado.</span>`;
            }
        } else {
            textoResultado += "Informe a marcação recebida para validar a dose real.";
        }

        resultDiv.innerHTML = textoResultado;
        drawSyringe(uiIdeal, receivedUi, syringeType);
    }

    function drawSyringe(uiIdeal, uiReal, maxUI) {
        const canvas = document.getElementById('syringeCanvas');
        const ctx = canvas.getContext('2d');
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        const startY = 10, height = 200, width = 35, centerX = canvas.width / 2 - width / 2;

        // Corpo
        ctx.strokeStyle = "#ccc";
        ctx.strokeRect(centerX, startY, width, height);

        // Desenhar Dose Real (O que a pessoa tem em mãos) - Sombra cinza ou vermelha
        if (uiReal > 0) {
            let fillReal = (uiReal / maxUI) * height;
            ctx.fillStyle = "rgba(231, 76, 60, 0.3)";
            ctx.fillRect(centerX + 2, (startY + height) - Math.min(fillReal, height), width - 4, Math.min(fillReal, height));
        }

        // Desenhar Linha da Dose Ideal (Onde deveria estar) - Linha Azul
        if (uiIdeal > 0) {
            let fillIdeal = (uiIdeal / maxUI) * height;
            ctx.strokeStyle = "#2980b9";
            ctx.lineWidth = 3;
            ctx.beginPath();
            let yPos = (startY + height) - Math.min(fillIdeal, height);
            ctx.moveTo(centerX - 5, yPos);
            ctx.lineTo(centerX + width + 5, yPos);
            ctx.stroke();
        }

        // Escala Lateral
        ctx.fillStyle = "#000";
        ctx.font = "10px Arial";
        ctx.lineWidth = 1;
        ctx.strokeStyle = "#000";
        for (let i = 0; i <= maxUI; i += (maxUI/10)) {
            let yPos = (startY + height) - (i / maxUI) * height;
            ctx.beginPath(); ctx.moveTo(centerX, yPos); ctx.lineTo(centerX + 8, yPos); ctx.stroke();
            ctx.fillText(i, centerX - 18, yPos + 4);
        }
    }

    function limpar() {
        document.querySelectorAll('input').forEach(i => i.value = "");
        document.getElementById('result').innerText = "Insira os dados da caneta para começar.";
        drawSyringe(0, 0, 100);
    }

    window.onload = () => drawSyringe(0, 0, 100);
</script>

</body>
</html>